---
layout: base.njk
pagination:
    data: products
    size: 1
    alias: product
permalink: "/produkti/{{ product.meta_title }}/"
eleventyComputed:
    title: "{{ product.title }}"
    description: "{{ product.short_description }}"
---

<section class="py-6 bg-primary-sand/30">
    <div class="max-w-7xl w-full mx-auto px-4">
        <!-- Title Container - Above images on mobile/tablet -->
        <div class="mb-2 md:hidden">
            <h1 class="text-xl text-center md:text-3xl font-bold text-primary-evergreen">{{ product.title }}</h1>
        </div>
        
        <div class="flex flex-col md:flex-row gap-8 md:gap-12 md:items-stretch">
            
            <!-- Product Images Carousel Container -->
            <div class="w-full md:w-1/2 md:flex md:flex-col md:order-1">
                <div class="flex flex-col gap-4 justify-center items-center md:h-full">
                    <!-- Main Image -->
                    {% if product.images and product.images.length > 0 %}
                        <div class="bg-white rounded-2xl shadow-md aspect-square overflow-hidden w-full h-full ">
                            <img id="product-main-image" src="{{ product.images[0] | url }}" alt="{{ product.title }}" class="w-full h-full object-cover transition-opacity duration-300">
                        </div>
                        
                        <!-- Thumbnails -->
                        {% if product.images.length > 1 %}
                            <div class="flex flex-wrap gap-3 justify-center">
                                {% for image in product.images %}
                                    {% if image %}
                                        <button class="product-thumbnail flex-shrink-0 w-20 h-20 opacity-60 hover:opacity-100 rounded-lg overflow-hidden transition-opacity cursor-pointer border-0 outline-none" data-image-src="{{ image | url }}">
                                            <img src="{{ image | url }}" alt="{{ product.title }} thumbnail {{ loop.index }}" class="w-full h-full object-cover">
                                        </button>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Product Info Container -->
            <div class="w-full md:w-1/2 md:h-[100%] flex flex-col gap-8 md:order-2">
                <!-- Title Container - Hidden on mobile/tablet, shown on desktop -->
                <div class="w-full hidden md:block">
                    <h1 class="text-xl md:text-3xl font-bold text-primary-evergreen">{{ product.title }}</h1>
                </div>
                
                <!-- Package Container -->
                {% if product.package %}
                    <div class="bg-white/40 rounded-2xl p-4">
                        <h3 class="text-lg font-semibold text-primary-evergreen mb-2">Опаковка</h3>
                        <p class="text-primary-volcanic">{{ product.package }}</p>
                    </div>
                {% endif %}
                
                <!-- Sustavki (Ingredients) Container -->
                {% if product.sustavki and product.sustavki.length > 0 %}
                    <div class="bg-white/40 rounded-2xl p-4">
                        <h3 class="text-lg font-semibold text-primary-evergreen mb-2">Съставки</h3>
                        <div class="text-primary-volcanic space-y-1">
                            {% for sustavka in product.sustavki %}
                                <p>- {{ sustavka }}</p>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
                
                <!-- Benefits Container -->
                {% if product.benefits and product.benefits.length > 0 %}
                    <div class="bg-white/40 rounded-2xl p-4 ">
                        <h3 class="text-lg font-semibold text-primary-evergreen mb-4">Ползи</h3>
                        <div class="flex flex-wrap gap-2">
                            {% for benefit in product.benefits %}
                                <div class="flex items-center gap-2 bg-white/80 rounded-full px-3 py-1.5">
                                    <img src="{{ benefit.benefit_icon | url }}" alt="{{ benefit.benefit_name }}" class="w-4 h-4 object-contain flex-shrink-0">
                                    <span class="text-primary-volcanic text-sm">{{ benefit.benefit_name }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
                
                <!-- Buy Now Button -->
                <button type="button" id="open-pharmacy-modal" class="bg-green-700 hover:bg-green-800 text-white w-full text-center rounded-2xl py-3 font-semibold transition-colors">
                    Намери в аптека
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Описание Section -->
{% if product.long_description %}
<section class="py-6 mt-6 bg-primary-sand/30">
    <div class="max-w-7xl w-full mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold text-primary-evergreen mb-6 flex items-center gap-3">
            <img src="{{ '/assets/images/description.png' | url }}" alt="Описание" class="w-8 h-8 object-contain">
            <span>Описание</span>
        </h2>
        <div class="bg-white/60 rounded-2xl p-6 md:p-8">
            <div class="prose prose-lg max-w-none">
                <p class="text-primary-deepsea leading-relaxed text-base md:text-lg">
                    {{ product.long_description }}
                </p>
            </div>
        </div>
    </div>
</section>
{% endif %}

{% if product.used_for or product.how_to_use %}
<section class="py-6 bg-primary-sand/30">
    <div class="max-w-7xl w-full mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold text-primary-evergreen mb-6 flex items-center gap-3">
            <img src="{{ '/assets/images/how-use.png' | url }}" alt="Как да използваме" class="w-8 h-8 object-contain">
            <span>Как да използваме</span>
        </h2>
        <div class="bg-white/50 rounded-2xl p-6 md:p-8 space-y-3 shadow-sm">
            {% if product.used_for %}
                <div class="space-y-1">
                    <h3 class="text-lg font-semibold text-primary-evergreen">За какво помага</h3>
                    <p class="text-primary-deepsea text-base md:text-lg leading-relaxed">{{ product.used_for }}</p>
                </div>
            {% endif %}
            {% if product.how_to_use %}
                <div class="space-y-1">
                    <h3 class="text-lg font-semibold text-primary-evergreen">Начин на употреба</h3>
                    <p class="text-primary-deepsea text-base md:text-lg leading-relaxed">{{ product.how_to_use }}</p>
                </div>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

{% if product.dosage or product.contraindications or product.storage %}
<section class="py-6 bg-primary-sand/30">
    <div class="max-w-7xl w-full mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-bold text-primary-evergreen mb-6 flex items-center gap-3">
            <img src="{{ '/assets/images/important.png' | url }}" alt="Важна информация" class="w-8 h-8 object-contain">
            <span>Важна информация</span>
        </h2>
        <div class="bg-white/50 rounded-2xl p-6 md:p-8 space-y-3 shadow-sm">
            {% if product.dosage %}
                <div class="space-y-1">
                    <h3 class="text-lg font-semibold text-primary-evergreen">Дозировка</h3>
                    <p class="text-primary-deepsea text-base md:text-lg leading-relaxed">{{ product.dosage }}</p>
                </div>
            {% endif %}
            {% if product.contraindications %}
                <div class="space-y-1">
                    <h3 class="text-lg font-semibold text-primary-evergreen">Противопоказания</h3>
                    <p class="text-primary-deepsea text-base md:text-lg leading-relaxed">{{ product.contraindications }}</p>
                </div>
            {% endif %}
            {% if product.storage %}
                <div class="space-y-1">
                    <h3 class="text-lg font-semibold text-primary-evergreen">Съхранение</h3>
                    <p class="text-primary-deepsea text-base md:text-lg leading-relaxed">{{ product.storage }}</p>
                </div>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

{% if relatedProducts and relatedProducts.length > 0 %}
<section class="py-6  bg-primary-sand/30">
    <div class="max-w-7xl w-full mx-auto px-4 ">
        <div class="flex items-center gap-3 mb-6">
            <span class="flex items-center justify-center w-10 h-10 ">
                <img src="{{ '/assets/images/products.png' | url }}" alt="Продукти" class="w-6 h-6 object-contain">
            </span>
            <h2 class="text-2xl md:text-3xl font-bold text-primary-evergreen">Разгледай други продукти</h2>
        </div>
        <div class="-mx-4 overflow-x-auto pb-8 md:mx-0 xl:overflow-visible xl:pb-0 custom-scrollbar no-scrollbar">
            <div class="flex gap-6 px-4 xl:px-0 xl:grid xl:grid-cols-4 xl:gap-6 drag-scroll">
                {% for item in relatedProducts %}
                    <div class="group relative flex-shrink-0">
                        <div class="home-product-card h-full p-2 bg-white rounded-3xl relative flex flex-col w-[240px] xl:w-full transition-all duration-300 shadow-md">
                            {% if item.images and item.images.length > 0 %}
                                <div class="home-product-image flex items-center justify-center overflow-hidden">
                                    <img src="{{ item.images[0] | url }}" alt="{{ item.title }}">
                                </div>
                            {% endif %}
                            <div class="pt-2 flex flex-col gap-4 flex-grow">
                                <div class="flex flex-col gap-2 justify-between">
                                    <h3 class="text-md font-bold">{{ item.title }}</h3>
                                    {% if item.short_description %}
                                        <p class="text-sm">{{ item.short_description }}</p>
                                    {% endif %}
                                </div>
                                <div class="product-card-benefits">
                                    {% if item.benefits and item.benefits.length > 0 %}
                                        <div class="benefit-icons flex flex-row gap-2">
                                            {% for benefit in item.benefits %}
                                                <div class="relative group benefit-icon-wrapper">
                                                    <img src="{{ benefit.benefit_icon | url }}" alt="{{ benefit.benefit_name }}" class="bg-primary-ceramic rounded-full h-8 w-8 object-contain">
                                                    <span class="benefit-tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max px-2 py-1 bg-primary-deepsea text-white text-xs rounded opacity-0 invisible transition-opacity duration-300 pointer-events-none">
                                                        {{ benefit.benefit_name }}
                                                    </span>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="mt-2 product-card-button flex flex-col flex-grow">
                                    <a href="{{ ('/produkti/' ~ item.meta_title ~ '/') | url }}" class="block text-center btn-primary font-semibold rounded-full py-2 mt-auto hover:bg-primary-evergreen/90 transition-colors">Виж продукта</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Pharmacy Modal -->
<div id="pharmacy-modal" class="fixed inset-0 z-[99999] hidden">
    <div class="absolute inset-0 bg-black/60 z-[1]" data-modal-overlay></div>
    <div class="relative z-[2] flex items-center justify-center min-h-screen p-4">
        <div class="pharmacy-modal max-h-[80vh] overflow-y-auto bg-white rounded-3xl shadow-[0_30px_80px_rgba(0,0,0,0.2)] max-w-xl w-full p-8 md:p-10 relative z-[3]">
            <button type="button" class="absolute top-4 right-4 text-primary-volcanic/60 hover:text-primary-volcanic transition-colors" data-close-modal>
                <span class="sr-only">Затвори</span>
                ✕
            </button>
            <div class="space-y-6 text-center">
                <div class="space-y-3">
                    <h3 class="text-2xl md:text-3xl font-bold text-primary-evergreen">Намери в аптека</h3>
                    <p class="text-primary-deepsea text-base md:text-lg leading-relaxed">Избери предпочитаната аптека.</p>
                </div>

                {% if product.pharmacies and product.pharmacies.length > 0 %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        {% for pharmacy in product.pharmacies %}
                            <a href="{{ pharmacy.link | url }}" class="group bg-primary-sand/40 hover:bg-primary-sand/60 border border-primary-sand/70 rounded-2xl px-5 py-4 flex flex-col items-center gap-3 transition-colors" target="_blank" rel="noopener">
                                <div class="w-20 h-20 flex items-center justify-center">
                                    <img src="{{ pharmacy.logo | url }}" alt="{{ pharmacy.name }}" class="w-20 h-20 object-contain">
                                </div>
                                <span class="text-primary-evergreen font-semibold">{{ pharmacy.name }}</span>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-primary-deepsea">В момента няма налични аптеки.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    .pharmacy-modal {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .pharmacy-modal::-webkit-scrollbar {
        display: none;
    }
</style>

<script src="{{ '/assets/js/product-carousel.js' | url }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const openButton = document.getElementById('open-pharmacy-modal');
        const modal = document.getElementById('pharmacy-modal');

        if (!openButton || !modal) {
            return;
        }

        const overlay = modal.querySelector('[data-modal-overlay]');
        const closeButtons = modal.querySelectorAll('[data-close-modal]');

        const openModal = () => {
            modal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
        };

        const closeModal = () => {
            modal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        };

        openButton.addEventListener('click', openModal);

        closeButtons.forEach((button) => {
            button.addEventListener('click', closeModal);
        });

        if (overlay) {
            overlay.addEventListener('click', closeModal);
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && !modal.classList.contains('hidden')) {
                closeModal();
            }
        });
    });
</script>
